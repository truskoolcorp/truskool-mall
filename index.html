<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Virtual Tru Skool Mall</title>
  <meta name="description" content="Virtual Tru Skool Mall — Three.js starter ready for Netlify/Vercel" />
  <style>
    :root { --bg:#0a0a0a; --panel:#0f0f0f; --border:#2a2a2a; --text:#eaeaea; --dim:#bdbdbd; --chip:#0f0f12; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow:hidden}

    #three{position:fixed;inset:0;width:100vw;height:100vh;display:block}

    .topbar{position:fixed;left:10px;right:10px;top:10px;z-index:30;display:flex;gap:10px;align-items:center;flex-wrap:wrap;
      background:rgba(15,15,15,.9);border:1px solid var(--border);border-radius:12px;padding:8px 10px;box-shadow:0 8px 28px rgba(0,0,0,.45)}
    .brand{font-weight:800;padding:6px 10px;background:#0d0d0d;border:1px solid var(--border);border-radius:10px;white-space:nowrap}
    #mallGrid{display:flex;gap:8px;align-items:center;overflow-x:auto;scrollbar-width:thin;padding:2px 0;flex:1 1 auto}
    .tile{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;background:var(--chip);border:1px solid var(--border);
      border-radius:10px;cursor:pointer;user-select:none;white-space:nowrap;transition:transform .12s,border-color .12s,background .12s}
    .tile:hover{transform:translateY(-1px);border-color:#3b3b3b;background:#121217}
    .tile img{width:16px;height:16px;object-fit:contain;border-radius:3px}

    .tip{position:fixed;right:16px;top:56px;z-index:20;background:rgba(15,15,15,.85);border:1px solid var(--border);
      border-radius:10px;padding:5px 10px;color:var(--dim);font-size:12px}

    .foot{position:fixed;left:0;right:0;bottom:6px;text-align:center;z-index:5;color:#8a8a8a;font-size:11px;text-shadow:0 1px 2px rgba(0,0,0,.6);pointer-events:none}

    #loader{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.6);z-index:50;transition:opacity .3s}
    #loader .box{display:grid;gap:12px;place-items:center}
    #loader .spinner{width:48px;height:48px;border-radius:50%;border:4px solid rgba(255,255,255,.2);border-top-color:#fff;animation:spin 1s linear infinite}
    #loader .msg{color:#fff;font:600 14px/1.2 system-ui,sans-serif;opacity:.9}
    @keyframes spin{to{transform:rotate(360deg)}}

    .help-btn{position:fixed;right:14px;top:14px;z-index:40;width:36px;height:36px;border-radius:10px;border:1px solid var(--border);
      background:var(--panel);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 4px 16px rgba(0,0,0,.35)}
    .help-panel{position:fixed;right:14px;top:58px;z-index:40;width:320px;max-width:calc(100% - 28px);background:rgba(15,15,15,.96);
      color:#eee;border:1px solid var(--border);border-radius:12px;padding:14px;box-shadow:0 12px 40px rgba(0,0,0,.45)}
    .help-panel h3{margin:0 0 8px;font:700 16px system-ui,sans-serif}
    .help-panel p,.help-panel li{font:400 13px/1.45 system-ui,sans-serif;color:#cfcfcf}
    .help-panel .close{position:absolute;right:8px;top:6px;background:transparent;border:0;color:#aaa;font-size:20px;cursor:pointer}

    @media (max-width:640px){.brand{display:none}.tip{display:none}}
  </style>
</head>
<body>
  <div id="loader" aria-live="polite">
    <div class="box">
      <div class="spinner" aria-hidden="true"></div>
      <div class="msg">Loading…</div>
    </div>
  </div>

  <button id="helpBtn" class="help-btn" aria-label="Help">?</button>
  <div id="helpPanel" class="help-panel" hidden>
    <button id="helpClose" class="close" aria-label="Close">×</button>
    <h3>Virtual Tru Skool Mall</h3>
    <ul>
      <li>Drag to look around; scroll or pinch to zoom.</li>
      <li>Click a brand tile or glowing portal to open its link.</li>
      <li>Press <b>H</b> or <b>?</b> to toggle this help.</li>
    </ul>
    <p>Manage brands in <code>src/stores.json</code> and logos in <code>assets/images/</code>.</p>
  </div>

  <div class="topbar" role="navigation" aria-label="Brand shortcuts">
    <div class="brand">Virtual Tru Skool Mall</div>
    <div id="mallGrid" aria-label="Stores"></div>
  </div>

  <div class="tip">Tip: Click a brand tile or 3D portal to open its link.</div>

  <canvas id="three"></canvas>

  <div class="foot">Starter template • three.js • Ready for Vercel/Netlify • Enhance with 3D avatars later</div>

  <noscript style="position:fixed;inset:0;display:grid;place-items:center;background:#000;color:#fff;z-index:100;">
    This site needs JavaScript enabled.
  </noscript>

  <!-- Inline import with fallback so the loader never gets stuck -->
  <script type="module">
    const loaderEl = document.getElementById('loader');
    const msg = loaderEl?.querySelector('.msg');

    import('./src/main.js').catch(err => {
      console.error('App failed to start:', err);
      if (msg) msg.textContent = 'Error starting app (see console)';
      if (loaderEl) loaderEl.style.background = 'rgba(0,0,0,.85)';
    });

    // Safety valve: hide loader after 7s even if something odd happens
    setTimeout(() => {
      if (!loaderEl) return;
      loaderEl.style.opacity = '0';
      setTimeout(() => (loaderEl.style.display = 'none'), 300);
    }, 7000);

    // Help panel wiring (kept here so it works even if main.js fails)
    const helpBtn = document.getElementById('helpBtn');
    const helpPanel = document.getElementById('helpPanel');
    const helpClose = document.getElementById('helpClose');
    const toggleHelp = (force) => {
      if (!helpPanel) return;
      if (typeof force === 'boolean') { helpPanel.hidden = !force; return; }
      helpPanel.hidden = !helpPanel.hidden;
    };
    helpBtn?.addEventListener('click', () => toggleHelp());
    helpClose?.addEventListener('click', () => toggleHelp(false));
    window.addEventListener('keydown', (e) => { if (e.key === 'h' || e.key === '?') toggleHelp(); });
  </script>
</body>
</html>
